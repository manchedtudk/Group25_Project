---
title: "Cleaning Data"
format: html
editor: visual
---

### Clear workspace

```{r}
rm(list = ls())
```

### Import Packages

```{r}
#| message: false
library(tidyverse)
library(stringr)
library(dplyr)
```

### Load Data File

```{r}
#| message: false
data_file <- read_csv(file = '~/projects/Group25_Project/data/01_dat_load.csv')
data_path <- "~/projects/Group25_Project/data"
outfile_path <- file.path(data_path, '02_dat_clean.csv')
```

### Filter Significant Subset

```{r}
sign_data <- data_file |>
             filter(p < 0.001 & log_fold_change > 2)|> # what about sign. negative change?
             arrange(desc(log_fold_change)) |>
             mutate_if(is.numeric, round, digits=4) # consider if we should round (p-value)
```

```{r}
sign_data <- sign_data |>
             mutate(cohort_type = case_when(
                                  str_detect(sample, "KIR_DP") ~ "KIR_DP",
                                  str_detect(sample, "KIR") ~ "KIR",
                                  .default = "MHC"),  
                    after = sample,
                    cohort_type = factor(cohort_type,
                                         levels=c("KIR_DP", "KIR", "MHC"))
               ) |>
            separate_wider_delim(
                    "sample",
                    delim = "_",
                    names = c("SampleID"),
                    too_many = "drop"
                )


```

#### Subset data set into cohorts (might not need to)

```{r}
AP_data <- sign_data |>
           filter(grepl('AP', SampleID))

BS_data <- sign_data |>
           filter(grepl('BS', SampleID))

BC_data <- sign_data |>
           filter(grepl('BC', SampleID))
```

### Export data

```{r}
write_csv(sign_data, outfile_path)
```
