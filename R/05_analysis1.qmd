---
title: "Analysis: Estimated Frequency"
format: html
editor: visual
---

#### Clean Work Environment

```{r}
rm(list = ls())
```

#### Load Packages

```{r}
#| message: false
library(tidyverse)
```

#### Load Data

```{r}
#| message: false
data_barra <- read_rds(file = '~/projects/Group25_Project/data/02_dat_clean_barracoda.RDS')
data_flow <- read_rds(file = '~/projects/Group25_Project/data/02_dat_clean_flowjo.RDS')
```

### Calculate estimated frequency

```{r}
#| warning: false
joined_data <- data_barra |>
               inner_join(data_flow, by='sample_ID')
```

```{r}
count_flow <- data_barra |> 
              group_by(sample_ID) |> 
              summarise(total_count = sum(count, na.rm = TRUE)) |> 
              right_join(joined_data, by = 'sample_ID')
```

```{r}
count_flow <- count_flow |>
              mutate(count_fraction = (count / total_count)) |> # count fraction
              mutate(Freq = count_fraction*PE_positive)       # Estimated frequency
```

### Filter for significant subset

```{r}
signi_data <- count_flow |>
              filter(p < 0.001 & log_fold_change > 2)|>
              arrange(desc(log_fold_change))
```

## Plot of logfold change vs epitope binding

```{r}

plot_data <- count_flow |>
             filter(log_fold_change>-2)
```

```{r}

ggplot(count_flow, 
       aes(x=protein, y=log_fold_change))
```
